# CodeQL Configuration for Private Repository
# This configuration file optimizes CodeQL analysis for private repositories
# with enhanced security scanning and proper authentication

name: "FreeNomad Private Repository CodeQL Configuration"

# Query configuration for comprehensive security analysis
queries:
  # Security-focused query packs
  - uses: security-extended
  - uses: security-and-quality

  # Additional security queries for private repositories
  - name: "Private Repository Security Queries"
    uses: github/codeql-queries/javascript/ql/src/Security

  # Custom queries for Next.js applications
  - name: "Next.js Security Queries"
    uses: github/codeql-queries/javascript/ql/src/experimental/Security

# Path configuration to optimize scanning
paths:
  # Include source code directories
  - "src/**"
  - "app/**"
  - "pages/**"
  - "components/**"
  - "lib/**"
  - "utils/**"
  - "hooks/**"
  - "middleware.ts"
  - "next.config.*"
  - "tailwind.config.*"
  - "prisma/**"
  - ".github/workflows/**"

# Paths to ignore for performance and accuracy
paths-ignore:
  # Dependencies and build artifacts
  - "node_modules/**"
  - ".next/**"
  - "dist/**"
  - "build/**"
  - "out/**"
  - "coverage/**"
  - ".vercel/**"

  # Test files (analyzed separately if needed)
  - "**/*.test.ts"
  - "**/*.test.js"
  - "**/*.test.tsx"
  - "**/*.test.jsx"
  - "**/*.spec.ts"
  - "**/*.spec.js"
  - "**/*.spec.tsx"
  - "**/*.spec.jsx"
  - "tests/**"
  - "__tests__/**"
  - "**/__mocks__/**"

  # Configuration and documentation
  - "*.md"
  - "*.txt"
  - "*.json" # Exclude package.json, etc. unless specifically needed
  - "*.lock"
  - ".env*"
  - ".git/**"
  - ".github/ISSUE_TEMPLATE/**"
  - ".github/PULL_REQUEST_TEMPLATE/**"

  # Static assets
  - "public/**"
  - "assets/**"
  - "static/**"
  - "**/*.svg"
  - "**/*.png"
  - "**/*.jpg"
  - "**/*.jpeg"
  - "**/*.gif"
  - "**/*.ico"

# Database configuration for private repositories
database:
  # Enhanced database creation for private repos
  finalize-database: true

# Private repository specific settings
private-repository:
  # Enhanced security scanning
  enable-experimental-features: true

  # Dependency analysis
  analyze-dependencies: true

  # Enhanced authentication
  use-github-token: true

  # Performance optimizations
  parallel-analysis: true
  memory-limit: "4096"

  # Error handling
  continue-on-error: false
  fail-on-error: true

# Language-specific configurations
languages:
  javascript:
    # Enhanced JavaScript/TypeScript analysis
    include-dependencies: false
    analyze-test-files: false

    # Framework-specific configurations
    frameworks:
      - "react"
      - "next.js"
      - "node.js"

    # Security-focused analysis
    security-queries:
      - "injection"
      - "xss"
      - "path-traversal"
      - "code-injection"
      - "sql-injection"
      - "nosql-injection"
      - "ldap-injection"
      - "xpath-injection"
      - "command-injection"
      - "unsafe-deserialization"
      - "prototype-pollution"
      - "regex-injection"
      - "server-side-request-forgery"
      - "open-redirect"
      - "weak-cryptography"
      - "hardcoded-credentials"
      - "insecure-randomness"
      - "information-exposure"
      - "missing-rate-limiting"
      - "cors-misconfiguration"
      - "csp-bypass"

# Reporting configuration
reporting:
  # Enhanced reporting for private repositories
  format: "sarif"
  include-source-locations: true
  include-data-flow-paths: true

  # Severity levels
  minimum-severity: "note"

  # Categories for organization
  categories:
    - "security"
    - "quality"
    - "maintainability"
    - "performance"

# Integration settings
integration:
  # GitHub Security tab integration
  upload-to-security-tab: true

  # Pull request integration
  comment-on-pull-requests: true

  # Status checks
  create-status-checks: true

  # Notifications
  notify-on-new-alerts: true

# Performance tuning for private repositories
performance:
  # Timeout settings
  analysis-timeout: "45m"
  upload-timeout: "10m"

  # Resource limits
  max-memory: "8192"
  max-disk-space: "20GB"

  # Parallel processing
  max-parallel-jobs: 4

  # Caching
  enable-caching: true
  cache-key: "codeql-${{ github.sha }}"

# Security settings specific to private repositories
security:
  # Token management
  use-github-app-token: false
  use-personal-access-token: false
  use-github-token: true

  # Access control
  restrict-access: true
  require-authentication: true

  # Audit logging
  enable-audit-logging: true
  log-level: "info"

  # Encryption
  encrypt-results: true
  encrypt-in-transit: true

  # Compliance
  compliance-mode: "strict"

# Maintenance and updates
maintenance:
  # Automatic updates
  auto-update-queries: true
  auto-update-database: true

  # Cleanup
  cleanup-old-results: true
  retention-period: "90d"

  # Monitoring
  enable-monitoring: true
  health-check-interval: "1h"
